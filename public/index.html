<!DOCTYPE html>
<html>
  <head>	
	<script src="js/jquery.js"></script>
    <link rel="stylesheet" type="text/css" href="index.css">
    <title>Socket.IO chat</title>
  </head>
  <body>
	
    <ul id="messages"></ul>
    <form id="form" action="">
      <input id="input" autocomplete="off" /><button>Send</button>
    </form>
	<script src="/socket.io/socket.io.js"></script>
    <script>
  		var socket = io();

		var form = document.getElementById('form');
		var input = document.getElementById('input');

		form.addEventListener('submit', function(e) {
    		e.preventDefault();
    		if (input.value) {
				socket.emit('chat message', input.value);
				input.value = '';
    		}
  		});
		socket.on('chat message', function(msg) {
			var item = document.createElement('li');
			item.innerHTML = msg.message
			messages.appendChild(item);
			window.scrollTo(0, document.body.scrollHeight);
  	});
	</script>
	<script>
	$.ajax({
    	url: server + "/",
    	method: "GET",
    	success: function (response) {
        	
			let msg = new TextEncoder()
			console.log(msg.encode(response));
 
        	var messages = document.getElementById("messages");
 
        	// parse JSON to javascript object
        	var data = JSON.parse(response);
        	for (var a = 0; a < data.length; a++) {
            	// creates new DOM element
            	var li = document.createElement("li");
 
            	// add message content as HTML
            	li.innerHTML = data[a].message;
 
            	// append at the end of list
            	messages.appendChild(li);
        	}
    	}
	});
		</script>
	</body>
</html>

